<!doctype html>
<html lang="en">

<!-- Head -->

<head>
  <!-- Page Meta Tags-->
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="keywords" content="">

  <!-- Custom Google Fonts-->
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;600&family=Roboto:wght@300;400;700&display=auto"
    rel="stylesheet">

  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="180x180"
    href="{{ url_for('static', filename='images/favicon/apple-touch-icon.png') }}">
  <link rel="icon" type="image/png" sizes="32x32"
    href="{{ url_for('static', filename='images/favicon/favicon-32x32.png') }}">
  <link rel="icon" type="image/png" sizes="16x16"
    href="{{ url_for('static', filename='images/favicon/favicon-16x16.png') }}">
  <link rel="mask-icon" href="{{ url_for('static', filename='images/favicon/safari-pinned-tab.svg') }}" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">


  <!-- Vendor CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/libs.bundle.css') }}" />

  <!-- Main CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/theme.bundle.css') }}" />
  <style>
    body, html, * {
      font-family: Helvetica, Arial, sans-serif !important;
    }
    body {
      background: #fff;
      min-height: 100vh;
    }
  </style>


  <link rel="manifest" href="/manifest.json">
  <!-- Flatpickr CSS: spostato qui per garantire il caricamento su mobile -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">


  <!-- Fix for custom scrollbar if JS is disabled-->
  <noscript>
    <style>
      /**
          * Reinstate scrolling for non-JS clients
          */
      .simplebar-content-wrapper {
        overflow: auto;
      }
    </style>
  </noscript>

  <!-- Page Title -->
  <title>location de voiture</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">


</head>

<body class="">
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/service-worker.js');
  }
</script>


<!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom mb-4">
        <div class="container d-flex justify-content-between align-items-center">
            <div>
                <a class="nav-link" href="/" style="font-family: Helvetica, Arial, sans-serif !important; font-weight:600; color:#222; font-size:1.1rem;">Home</a>
            </div>
            <div>
                <img src="{{ url_for('static', filename='images/logos/logo1.png') }}" alt="CarBarossa" height="54" style="margin-left:10px;">
            </div>
        </div>
    </nav>


  

  <!-- Main Section-->
  <section class="mt-0 ">
    <!-- Page Content Goes Here -->

    <!-- Breadcrumbs-->
    <div style="background: linear-gradient(120deg, #ff9800 0%, #df8602 50%, #ff9800 100%);" class="py-6">
    </div>
    <!-- / Breadcrumbs-->


    <div class="container-fluid mt-5">

      <!-- Product Top Section-->
      <div class="row g-9" data-sticky-container>

        <!-- Immagini Prodotto-->
        {% if success_message %}
        <div class="alert alert-success" role="alert" style="position:relative; left:0px; top:-120px; font-size:1.2rem; font-weight:500;">
          <i class="ri-check-line" style="font-size:1.5rem; color:#198754; vertical-align:middle;"></i>
          {{ success_message }}
        </div>
        {% endif %}
        {% if error_message %}
        <div class="alert alert-danger" role="alert">
          {{ error_message }}
        </div>
        {% endif %}
        {% if auto %}
        <div class="col-12 col-md-6 col-xl-7">
          <div class="row g-3 justify-content-center" data-aos="fade-right">
            <div class="col-12 d-flex justify-content-center">
              <picture>
                <img class="img-fluid car-image-custom" data-zoomable
                  src="{{ url_for('static', filename='images/cars/'+auto.image) }}"
                  alt="{{ auto.modello }} {{ auto.marca }}">
              </picture>
            </div>
          </div>
          <style>
            .car-image-custom {
              display: block;
              margin: 0 auto 18px auto;
              max-width: 420px;
              width: 100%;
              height: 240px;
              object-fit: cover;
              border-radius: 14px;
              box-shadow: 0 2px 16px rgba(0,123,255,0.10);
              background: #fff;
              border: none;
            }
            @media (max-width: 900px) {
              .car-image-custom { max-width: 100%; height: 180px; }
            }
            @media (max-width: 600px) {
              .car-image-custom { height: 120px; }
            }
          </style>
          <!-- Info auto visibili -->
          <div class="car-info-box mt-4 p-4 rounded shadow" style="background: #f8f9fa;">
            <div class="row g-3 align-items-center">
              <div class="col-6 col-md-3 text-center">
                <div class="info-icon mb-2" style="font-size:2.2rem;color:#007bff;"><i class="ri-car-line"></i></div>
                <div class="fw-bold">Modello</div>
                <div>{{auto.modello}}</div>
              </div>
              <div class="col-6 col-md-3 text-center">
                <div class="info-icon mb-2" style="font-size:2.2rem;color:#007bff;"><i class="ri-building-2-line"></i></div>
                <div class="fw-bold">Marca</div>
                <div>{{auto.marca}}</div>
              </div>
              <div class="col-6 col-md-3 text-center">
                <div class="info-icon mb-2" style="font-size:2.2rem;color:#007bff;"><i class="ri-hashtag"></i></div>
                <div class="fw-bold">Targa</div>
                <div>{{auto.targa}}</div>
              </div>
              <div class="col-6 col-md-3 text-center">
                <div class="info-icon mb-2" style="font-size:2.2rem;color:#007bff;"><i class="ri-calendar-2-line"></i></div>
                <div class="fw-bold">Anno</div>
                <div>{{auto.anno}}</div>
              </div>
            </div>
            <!-- Descrizione rimossa come richiesto -->
          </div>
        </div>
        <!-- /Immagini Prodotto e Info-->

        <!-- Informazioni Prodotto-->
        <div class="col-12 col-md-6 col-lg-5">
          <div class="sticky-top top-5">
            <div class="pb-3" data-aos="fade-in">
              <h1 class="mb-1 fs-2 fw-bold">{{auto.modello}} {{auto.marca}}</h1>
              <div class="d-flex justify-content-between align-items-center">
                <p class="fs-4 m-0">{{auto.prezzo}} €/giorno</p>
              </div>
              <p class="mt-2">{{auto.descrizione}}</p>
              <!-- Targa e Anno rimossi dalla prenotazione, restano nella tabella sotto -->

              <form action="/location_car/{{ auto._id }}" method="POST">
                <div class="mb-3">
                  <label for="nome" class="form-label">Nome</label>
                  <input type="text" id="nome" name="nome" class="form-control" required>
                </div>
                <div class="mb-3">
                  <label for="cognome" class="form-label">Cognome</label>
                  <input type="text" id="cognome" name="cognome" class="form-control" required>
                </div>
                <div class="mb-3">
                  <label for="email" class="form-label">Email</label>
                  <input type="email" id="email" name="email" class="form-control" required>
                </div>
                <div class="mb-3">
                  <label for="telefono" class="form-label">Telefono</label>
                  <input type="tel" id="telefono" name="telefono" class="form-control" required pattern="^\\+\\d{2,3}\\d{10}$" placeholder="+39XXXXXXXXXX">
                  <small class="form-text text-muted">Formato: +39 seguito da 10 cifre</small>
                </div>
                <div class="mb-3">
                  <label for="date_debut" class="form-label">Data inizio</label>
                  <input type="text" id="date_debut" name="date_debut" class="form-control" required readonly>
                </div>
                <div class="mb-3">
                  <label for="date_fin" class="form-label">Data fine</label>
                  <input type="text" id="date_fin" name="date_fin" class="form-control" required readonly>
                </div>
                <!-- Flatpickr CSS rimosso: ora nel <head> -->
                <style>
                  .flatpickr-day.blocked, .flatpickr-day.blocked:hover {
                    background: #e30613 !important;
                    color: #fff !important;
                    border-radius: 50% !important;
                    cursor: not-allowed !important;
                  }
                  .flatpickr-day.available, .flatpickr-day.available:hover {
                    background: #007bff !important;
                    color: #fff !important;
                    border-radius: 50% !important;
                  }
                  .flatpickr-day.past, .flatpickr-day.past:hover {
                    background: #ccc !important;
                    color: #888 !important;
                    border-radius: 50% !important;
                    cursor: not-allowed !important;
                    pointer-events: none !important;
                    opacity: 0.7 !important;
                  }
                  .flatpickr-day.selected-start {
                    background: #ff9800 !important;
                    color: #fff !important;
                    border: 2px solid #ffb74d !important;
                  }
                </style>
                <!-- Flatpickr JS -->
                <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
                <script>
                  document.addEventListener('DOMContentLoaded', function() {
                    // Array delle date bloccate passato dal backend
                    const giorniBloccati = {{ giorni_bloccati|tojson }};
                    // Utility per formattare la data in YYYY-MM-DD
                    function formatDate(date) {
                      const d = new Date(date);
                      const month = (d.getMonth() + 1).toString().padStart(2, '0');
                      const day = d.getDate().toString().padStart(2, '0');
                      return `${d.getFullYear()}-${month}-${day}`;
                    }
                    // Oggi (usato per colorare i giorni passati)
                    const today = new Date();
                    today.setHours(0,0,0,0);
                    let selectedStart = null;
                    // Flatpickr per Data Inizio
                    flatpickr("#date_debut", {
                      dateFormat: "Y-m-d",
                      minDate: today,
                      disable: giorniBloccati,
                      onDayCreate: function(dObj, dStr, fp, dayElem) {
                        const date = dayElem.dateObj;
                        const dateStr = formatDate(date);
                        if (date < today) {
                          dayElem.classList.add('past');
                          dayElem.setAttribute('aria-disabled', 'true');
                          dayElem.setAttribute('tabindex', '-1');
                          dayElem.classList.add('flatpickr-disabled');
                        } else if (giorniBloccati.includes(dateStr)) {
                          dayElem.classList.add('blocked');
                        } else {
                          dayElem.classList.add('available');
                        }
                        if (selectedStart && dateStr === selectedStart) {
                          dayElem.classList.add('selected-start');
                        }
                      },
                      onChange: function(selectedDates, dateStr, instance) {
                        // Aggiorna la minDate di fine
                        if (selectedDates.length > 0) {
                          dateFinPicker.set('minDate', dateStr);
                          selectedStart = dateStr;
                          // Se la data di fine è prima della data di inizio, resetta
                          if (dateFinPicker.input.value && dateFinPicker.input.value < dateStr) {
                            dateFinPicker.clear();
                          }
                          // Evidenzia la data selezionata nel selettore di fine
                          setTimeout(() => {
                            const days = document.querySelectorAll(".flatpickr-calendar:last-of-type .flatpickr-day");
                            days.forEach(day => {
                              if (day.dateObj && formatDate(day.dateObj) === selectedStart) {
                                day.classList.add('selected-start');
                              } else {
                                day.classList.remove('selected-start');
                              }
                            });
                          }, 100);
                        }
                      }
                    });
                    // Flatpickr per Data Fine
                    const dateFinPicker = flatpickr("#date_fin", {
                      dateFormat: "Y-m-d",
                      minDate: today,
                      disable: giorniBloccati,
                      onDayCreate: function(dObj, dStr, fp, dayElem) {
                        const date = dayElem.dateObj;
                        const dateStr = formatDate(date);
                        if (date < today) {
                          dayElem.classList.add('past');
                        } else if (giorniBloccati.includes(dateStr)) {
                          dayElem.classList.add('blocked');
                        } else {
                          dayElem.classList.add('available');
                        }
                        if (selectedStart && dateStr === selectedStart) {
                          dayElem.classList.add('selected-start');
                        }
                      }
                    });
                  });
                </script>
                </div>
                <button type="submit" class="btn btn-dark w-100 mt-4 mb-0 hover-lift-sm hover-boxshadow">Prenota</button>
              </form>
            </div>
          </div>
        </div>
        {% endif %}
      </div>
      <!-- / Product Top Section-->

      <div class="row g-0">




      </div>

    </div>

    <!-- /Page Content -->
  </section>
  <!-- / Main Section-->

  <!-- Footer -->
  <footer class="border-top py-5 mt-4  ">
    <div class="container-fluid">
      <div class="d-flex justify-content-between align-items-center flex-column flex-lg-row">
        <div class="d-flex align-items-center justify-content-end flex-column flex-lg-row">
          <p class="small m-0 text-center text-lg-start">&copy; 2023 CarRentingApp</p>
        </div>
      </div>
    </div>




  </footer> <!-- / Footer-->

  <!-- Theme JS -->



  <script src=" {{ url_for('static', filename='js/vendor.bundle.js') }}"></script>
  <script src=" {{ url_for('static', filename='js/theme.bundle.js') }}"></script>




  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>



  <script>
    // Imposta la data minima per oggi lato JS (fallback se il template non la imposta)
    document.addEventListener('DOMContentLoaded', function() {
      var today = new Date();
      var yyyy = today.getFullYear();
      var mm = String(today.getMonth() + 1).padStart(2, '0');
      var dd = String(today.getDate()).padStart(2, '0');
      var minDate = yyyy + '-' + mm + '-' + dd;
      var dateDebut = document.getElementById('date_debut');
      var dateFin = document.getElementById('date_fin');
      if (dateDebut) dateDebut.setAttribute('min', minDate);
      if (dateFin) dateFin.setAttribute('min', minDate);

      // Quando cambia la data di inizio, aggiorna la data minima di fine
      if (dateDebut && dateFin) {
        dateDebut.addEventListener('change', function() {
          if (dateDebut.value) {
            dateFin.min = dateDebut.value;
            if (dateFin.value < dateDebut.value) {
              dateFin.value = dateDebut.value;
            }
          } else {
            dateFin.min = minDate;
          }
        });
      }
    });
    function updateClientInfo() {
      var clientSelect = document.getElementById("client");
      var telephoneInput = document.getElementById("telephone");
      var emailInput = document.getElementById("email");
      var telephoneLabel = document.getElementById("telephoneLabel");
      var emailLabel = document.getElementById("emailLabel");

      var selectedOption = clientSelect.options[clientSelect.selectedIndex];
      var telephone = selectedOption.getAttribute("data-telephone");
      var email = selectedOption.getAttribute("data-email");

      if (telephone && email) {
        telephoneInput.value = telephone;
        emailInput.value = email;
        telephoneLabel.style.display = "block";
        emailLabel.style.display = "block";
        telephoneInput.style.display = "block";
        emailInput.style.display = "block";
      } else {
        telephoneInput.value = "";
        emailInput.value = "";
        telephoneLabel.style.display = "none";
        emailLabel.style.display = "none";
        telephoneInput.style.display = "none";
        emailInput.style.display = "none";
      }
    }


  </script>




</body>

</html>